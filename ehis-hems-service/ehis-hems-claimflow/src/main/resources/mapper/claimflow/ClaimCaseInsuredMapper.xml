<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paic.ehis.claimflow.mapper.ClaimCaseInsuredMapper">

    <resultMap type="com.paic.ehis.claimflow.domain.ClaimCaseInsured" id="ClaimCaseInsuredResult">
        <result property="ciId"    column="ci_id"    />
        <result property="rptNo"    column="rpt_no"    />
        <result property="insuredNo"    column="insured_no"    />
        <result property="name"    column="name"    />
        <result property="sex"    column="sex"    />
        <result property="idType"    column="id_type"    />
        <result property="idNo"    column="id_no"    />
        <result property="birthday"    column="birthday"    />
        <result property="occupation"    column="occupation"    />
        <result property="nationality"    column="nationality"    />
        <result property="idStartDate"    column="id_start_date"    />
        <result property="idEndDate"    column="id_end_date"    />
        <result property="mobile"    column="mobile"    />
        <result property="email"    column="email"    />
        <result property="phone"    column="phone"    />
        <result property="province"    column="province"    />
        <result property="city"    column="city"    />
        <result property="district"    column="district"    />
        <result property="address"    column="address"    />
        <result property="status"    column="status"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="caseStatus"    column="case_status"    />
    </resultMap>

    <resultMap type="com.paic.ehis.claimflow.domain.ClaimCaseInsured" id="ClaimCaseInsuredResult1">
        <result property="ciId"    column="ci_id"    />
        <result property="rptNo"    column="rpt_no"    />
        <result property="insuredNo"    column="insured_no"    />
        <result property="name"    column="name"    />
        <result property="sex"    column="sex"    />
        <result property="idType"    column="id_type"    />
        <result property="idNo"    column="id_no"    />
        <result property="birthday"    column="birthday"    />
        <result property="occupation"    column="occupation"    />
        <result property="nationality"    column="nationality"    />
        <result property="idStartDate"    column="id_start_date"    />
        <result property="idEndDate"    column="id_end_date"    />
        <result property="mobile"    column="mobile"    />
        <result property="email"    column="email"    />
        <result property="phone"    column="phone"    />
        <result property="province"    column="province"    />
        <result property="city"    column="city"    />
        <result property="district"    column="district"    />
        <result property="address"    column="address"    />
        <result property="status"    column="status"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="source"    column="source"    />
        <result property="caseStatus"    column="case_status"    />
        <result property="age"    column="age"    />
    </resultMap>

    <sql id="selectClaimCaseInsuredTwoVo">
        select ci_id,rpt_no,insured_no,name,sex,id_type,id_no,birthday,occupation,nationality,id_start_date,id_end_date,mobile,email,phone,province,city,district,address,status,create_by,create_time,update_by,update_time from claim_case_insured
    </sql>

    <sql id="selectClaimCaseInsuredVo">
        SELECT
	claim_batch.source,
	claim_case.case_status,
	claim_case_insured.rpt_no,
	insured_no,
	NAME,
	sex,
	id_type,
	id_no,
	birthday,
	occupation,
	nationality,
	id_start_date,
	id_end_date,
	mobile,
	email,
	phone,
	province,
	city,
	district,
	address,
	claim_case_insured.STATUS,
	claim_case_insured.create_by,
	claim_case_insured.create_time,
	claim_case_insured.update_by,
	claim_case_insured.update_time
FROM
	claim_case_insured,
	claim_case_problem,
	claim_case,
	claim_batch
    </sql>

    <select id="selectClaimCaseInsuredList" parameterType="com.paic.ehis.claimflow.domain.ClaimCaseInsured" resultMap="ClaimCaseInsuredResult1">
        <include refid="selectClaimCaseInsuredVo"/>
        <where>
            <if test="rptNo != null  and rptNo != ''"> and claim_case_insured.rpt_no = #{rptNo}</if>
            <if test="insuredNo != null  and insuredNo != ''"> and insured_no = #{insuredNo}</if>
            <if test="name != null  and name != ''"> and name like concat('%', #{name}, '%')</if>
            <if test="sex != null  and sex != ''"> and sex = #{sex}</if>
            <if test="idType != null  and idType != ''"> and id_type = #{idType}</if>
            <if test="idNo != null  and idNo != ''"> and id_no = #{idNo}</if>
            <if test="birthday != null "> and birthday = #{birthday}</if>
            <if test="occupation != null  and occupation != ''"> and occupation = #{occupation}</if>
            <if test="nationality != null  and nationality != ''"> and nationality = #{nationality}</if>
            <if test="idStartDate != null "> and id_start_date = #{idStartDate}</if>
            <if test="idEndDate != null "> and id_end_date = #{idEndDate}</if>
            <if test="mobile != null  and mobile != ''"> and mobile = #{mobile}</if>
            <if test="email != null  and email != ''"> and email = #{email}</if>
            <if test="phone != null  and phone != ''"> and phone = #{phone}</if>
            <if test="province != null  and province != ''"> and province = #{province}</if>
            <if test="city != null  and city != ''"> and city = #{city}</if>
            <if test="district != null  and district != ''"> and district = #{district}</if>
            <if test="address != null  and address != ''"> and address = #{address}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="source != null  and source != ''"> and claim_batch.source = #{source}</if>
            <if test="caseStatus != null  and caseStatus != ''"> and claim_case.case_status = #{caseStatus}</if>
            and claim_case_problem.rpt_no = claim_case_insured.rpt_no
            AND claim_case_problem.rpt_no = claim_case.rpt_no
            AND claim_batch.batch_no = claim_case.batch_no
        </where>
    </select>

    <select id="selectClaimCaseInsuredById" parameterType="String" resultMap="ClaimCaseInsuredResult">
        <include refid="selectClaimCaseInsuredTwoVo"/>
        where rpt_no = #{rptNo} and status = 'Y'
    </select>

    <insert id="insertClaimCaseInsured" parameterType="ClaimCaseInsured">
        insert into claim_case_insured
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="rptNo != null">rpt_no,</if>
            <if test="insuredNo != null and insuredNo != ''">insured_no,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="sex != null and sex != ''">sex,</if>
            <if test="idType != null and idType != ''">id_type,</if>
            <if test="idNo != null and idNo != ''">id_no,</if>
            <if test="birthday != null">birthday,</if>
            <if test="occupation != null">occupation,</if>
            <if test="nationality != null">nationality,</if>
            <if test="idStartDate != null">id_start_date,</if>
            <if test="idEndDate != null">id_end_date,</if>
            <if test="mobile != null">mobile,</if>
            <if test="email != null">email,</if>
            <if test="phone != null">phone,</if>
            <if test="province != null">province,</if>
            <if test="city != null">city,</if>
            <if test="district != null">district,</if>
            <if test="address != null">address,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="createBy != null and createBy != ''">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="rptNo != null">#{rptNo},</if>
            <if test="insuredNo != null and insuredNo != ''">#{insuredNo},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="sex != null and sex != ''">#{sex},</if>
            <if test="idType != null and idType != ''">#{idType},</if>
            <if test="idNo != null and idNo != ''">#{idNo},</if>
            <if test="birthday != null">#{birthday},</if>
            <if test="occupation != null">#{occupation},</if>
            <if test="nationality != null">#{nationality},</if>
            <if test="idStartDate != null">#{idStartDate},</if>
            <if test="idEndDate != null">#{idEndDate},</if>
            <if test="mobile != null">#{mobile},</if>
            <if test="email != null">#{email},</if>
            <if test="phone != null">#{phone},</if>
            <if test="province != null">#{province},</if>
            <if test="city != null">#{city},</if>
            <if test="district != null">#{district},</if>
            <if test="address != null">#{address},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="createBy != null and createBy != ''">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
         </trim>
    </insert>

    <update id="updateClaimCaseInsured" parameterType="ClaimCaseInsured">
        update claim_case_insured
        <trim prefix="SET" suffixOverrides=",">
            <if test="rptNo != null and rptNo != ''">rpt_no = #{rptNo},</if>
            <if test="insuredNo != null and insuredNo != ''">insured_no = #{insuredNo},</if>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="sex != null and sex != ''">sex = #{sex},</if>
            <if test="idType != null and idType != ''">id_type = #{idType},</if>
            <if test="idNo != null and idNo != ''">id_no = #{idNo},</if>
            <if test="birthday != null">birthday = #{birthday},</if>
            <if test="occupation != null">occupation = #{occupation},</if>
            <if test="nationality != null">nationality = #{nationality},</if>
            <if test="idStartDate != null">id_start_date = #{idStartDate},</if>
            <if test="idEndDate != null">id_end_date = #{idEndDate},</if>
            <if test="mobile != null">mobile = #{mobile},</if>
            <if test="email != null">email = #{email},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="province != null">province = #{province},</if>
            <if test="city != null">city = #{city},</if>
            <if test="district != null">district = #{district},</if>
            <if test="address != null">address = #{address},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="createBy != null and createBy != ''">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </trim>
        where ci_id = #{ciId}
    </update>

    <delete id="deleteClaimCaseInsuredById" parameterType="String">
        delete from claim_case_insured where rpt_no = #{rptNo}
    </delete>

    <delete id="deleteClaimCaseInsuredByIds" parameterType="String">
        delete from claim_case_insured where rpt_no in
        <foreach item="rptNo" collection="array" open="(" separator="," close=")">
            #{rptNo}
        </foreach>
    </delete>

    <select id="selectClaimCaseInsuredListByRptNo" parameterType="String" resultMap="ClaimCaseInsuredResult">
        <include refid="selectClaimCaseInsuredTwoVo"/>
        where rpt_no = #{rptNo} and status='Y'
    </select>

    <select id="selectCaseList" parameterType="String" resultMap="ClaimCaseInsuredResult">
        <include refid="selectClaimCaseInsuredTwoVo"/>
        where rpt_no = #{rptNo} and status='Y'
    </select>

    <select id="selectClaimCaseInsuredListByRptNoTwo" parameterType="String" resultMap="ClaimCaseInsuredResult">
        <include refid="selectClaimCaseInsuredTwoVo"/>
        where rpt_no = #{rptNo} and status='Y'
    </select>
    <select id="selectRptNo" parameterType="String" resultMap="ClaimCaseInsuredResult">
        SELECT
            cc.rpt_no,
            (select cci. NAME from claim_case_insured cci where cc.rpt_no=cci.rpt_no) name,
            cc.case_status
        FROM
            claim_case cc
        WHERE
            cc.batch_no = #{batchNo}
        ORDER BY
            cc.rpt_no ASC
    </select>
</mapper>
