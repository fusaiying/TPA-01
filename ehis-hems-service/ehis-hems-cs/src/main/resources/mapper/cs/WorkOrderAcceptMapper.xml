<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paic.ehis.cs.mapper.WorkOrderAcceptMapper">
    
    <resultMap type="com.paic.ehis.cs.domain.WorkOrderAccept" id="WorkOrderAcceptResult">
        <result property="workOrderNo"    column="work_order_no"    />
        <result property="businessType"    column="business_type"    />
        <result property="policyNo"    column="policy_no"    />
        <result property="policyItemNo"    column="policy_item_no"    />
        <result property="riskCode"    column="risk_code"    />
        <result property="insuredNo"    column="insured_no"    />
        <result property="insuredName"    column="insured_name"    />
        <result property="holderNo"    column="holder_no"    />
        <result property="holderName"    column="holder_name"    />
        <result property="acceptBy"    column="accept_by"    />
        <result property="acceptTime"    column="accept_time"    />
        <result property="modifyBy"    column="modify_by"    />
        <result property="modifyTime"    column="modify_time"    />
        <result property="vipFlag"    column="vip_flag"    />
        <result property="organCode"    column="organ_code"    />
        <result property="status"    column="status"    />
        <result property="endDate"    column="end_date"    />
        <result property="clickTime"    column="click_time"    />
        <result property="hangFlag"    column="hang_flag"    />
        <result property="hangReason"    column="hang_reason"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="activationNum"    column="activation_num"    />
    </resultMap>

    <sql id="selectWorkOrderAcceptVo">
        select work_order_no, activation_num,business_type, policy_no, policy_item_no, risk_code, insured_no, insured_name, holder_no, holder_name, accept_by, accept_time, modify_by, modify_time, vip_flag, organ_code, status, end_date, click_time, hang_flag, hang_reason, create_by, create_time, update_by, update_time from work_order_accept
    </sql>


    <select id="selectWorkOrderAcceptList" parameterType="WorkOrderAccept" resultMap="WorkOrderAcceptResult">
        <include refid="selectWorkOrderAcceptVo"/>
        <where>
            <if test="businessType != null  and businessType != ''"> and business_type = #{businessType}</if>
            <if test="policyNo != null  and policyNo != ''"> and policy_no = #{policyNo}</if>
            <if test="policyItemNo != null  and policyItemNo != ''"> and policy_item_no = #{policyItemNo}</if>
            <if test="riskCode != null  and riskCode != ''"> and risk_code = #{riskCode}</if>
            <if test="insuredNo != null  and insuredNo != ''"> and insured_no = #{insuredNo}</if>
            <if test="insuredName != null  and insuredName != ''"> and insured_name like concat('%', #{insuredName}, '%')</if>
            <if test="holderNo != null  and holderNo != ''"> and holder_no = #{holderNo}</if>
            <if test="holderName != null  and holderName != ''"> and holder_name like concat('%', #{holderName}, '%')</if>
            <if test="acceptBy != null  and acceptBy != ''"> and accept_by = #{acceptBy}</if>
            <if test="acceptTime != null "> and accept_time = #{acceptTime}</if>
            <if test="modifyBy != null  and modifyBy != ''"> and modify_by = #{modifyBy}</if>
            <if test="modifyTime != null "> and modify_time = #{modifyTime}</if>
            <if test="vipFlag != null  and vipFlag != ''"> and vip_flag = #{vipFlag}</if>
            <if test="organCode != null  and organCode != ''"> and organ_code = #{organCode}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="endDate != null "> and end_date = #{endDate}</if>
            <if test="clickTime != null "> and click_time = #{clickTime}</if>
            <if test="hangFlag != null  and hangFlag != ''"> and hang_flag = #{hangFlag}</if>
            <if test="hangReason != null  and hangReason != ''"> and hang_reason = #{hangReason}</if>
        </where>
    </select>
    
    <select id="selectWorkOrderAcceptById" parameterType="String" resultMap="WorkOrderAcceptResult">
        <include refid="selectWorkOrderAcceptVo"/>
        where work_order_no = #{workOrderNo}
    </select>

    <select id="selectProcessingTimeById" parameterType="String" resultType="java.lang.String">
        select TIMESTAMPDIFF(HOUR,create_time,click_time) from work_order_accept where work_order_no = #{workOrderNo}
    </select>
        
    <insert id="insertWorkOrderAccept" parameterType="com.paic.ehis.cs.domain.WorkOrderAccept">
        insert into work_order_accept
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="workOrderNo != null">work_order_no,</if>
            <if test="businessType != null and businessType != ''">business_type,</if>
            <if test="policyNo != null">policy_no,</if>
            <if test="policyItemNo != null">policy_item_no,</if>
            <if test="riskCode != null">risk_code,</if>
            <if test="insuredNo != null">insured_no,</if>
            <if test="insuredName != null">insured_name,</if>
            <if test="holderNo != null">holder_no,</if>
            <if test="holderName != null">holder_name,</if>
            <if test="acceptBy != null">accept_by,</if>
            <if test="acceptTime != null">accept_time,</if>
            <if test="modifyBy != null">modify_by,</if>
            <if test="modifyTime != null">modify_time,</if>
            <if test="vipFlag != null">vip_flag,</if>
            <if test="organCode != null">organ_code,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="endDate != null">end_date,</if>
            <if test="clickTime != null">click_time,</if>
            <if test="hangFlag != null">hang_flag,</if>
            <if test="hangReason != null">hang_reason,</if>
            <if test="createBy != null and createBy != ''">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null and updateBy != ''">update_by,</if>
            <if test="updateTime != null">update_time,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="workOrderNo != null">#{workOrderNo},</if>
            <if test="businessType != null and businessType != ''">#{businessType},</if>
            <if test="policyNo != null">#{policyNo},</if>
            <if test="policyItemNo != null">#{policyItemNo},</if>
            <if test="riskCode != null">#{riskCode},</if>
            <if test="insuredNo != null">#{insuredNo},</if>
            <if test="insuredName != null">#{insuredName},</if>
            <if test="holderNo != null">#{holderNo},</if>
            <if test="holderName != null">#{holderName},</if>
            <if test="acceptBy != null">#{acceptBy},</if>
            <if test="acceptTime != null">#{acceptTime},</if>
            <if test="modifyBy != null">#{modifyBy},</if>
            <if test="modifyTime != null">#{modifyTime},</if>
            <if test="vipFlag != null">#{vipFlag},</if>
            <if test="organCode != null">#{organCode},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="endDate != null">#{endDate},</if>
            <if test="clickTime != null">#{clickTime},</if>
            <if test="hangFlag != null">#{hangFlag},</if>
            <if test="hangReason != null">#{hangReason},</if>
            <if test="createBy != null and createBy != ''">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null and updateBy != ''">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
        </trim>
    </insert>

    <update id="updateWorkOrderAccept" parameterType="com.paic.ehis.cs.domain.WorkOrderAccept">
        update work_order_accept
        <trim prefix="SET" suffixOverrides=",">
            <if test="businessType != null and businessType != ''">business_type = #{businessType},</if>
            <if test="policyNo != null">policy_no = #{policyNo},</if>
            <if test="policyItemNo != null">policy_item_no = #{policyItemNo},</if>
            <if test="riskCode != null">risk_code = #{riskCode},</if>
            <if test="insuredNo != null">insured_no = #{insuredNo},</if>
            <if test="insuredName != null">insured_name = #{insuredName},</if>
            <if test="holderNo != null">holder_no = #{holderNo},</if>
            <if test="holderName != null">holder_name = #{holderName},</if>
            <if test="acceptBy != null">accept_by = #{acceptBy},</if>
            <if test="acceptTime != null">accept_time = #{acceptTime},</if>
            <if test="modifyBy != null">modify_by = #{modifyBy},</if>
            <if test="modifyTime != null">modify_time = #{modifyTime},</if>
            <if test="vipFlag != null">vip_flag = #{vipFlag},</if>
            <if test="organCode != null">organ_code = #{organCode},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="endDate != null">end_date = #{endDate},</if>
            <if test="clickTime != null">click_time = #{clickTime},</if>
            <if test="hangFlag != null">hang_flag = #{hangFlag},</if>
            <if test="hangReason != null">hang_reason = #{hangReason},</if>
            <if test="createBy != null and createBy != ''">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </trim>
        where work_order_no = #{workOrderNo}
    </update>
    <update id="updateWorkOrderStatus" parameterType="com.paic.ehis.cs.domain.WorkOrderAccept">
        UPDATE work_order_accept set status = #{status}  where work_order_no=#{workOrderNo}
    </update>

    <delete id="deleteWorkOrderAcceptById" parameterType="String">
        delete from work_order_accept where work_order_no = #{workOrderNo}
    </delete>

    <delete id="deleteWorkOrderAcceptByIds" parameterType="String">
        delete from work_order_accept where work_order_no in 
        <foreach item="workOrderNo" collection="array" open="(" separator="," close=")">
            #{workOrderNo}
        </foreach>
    </delete>

    <select id="selectProcessingTime" parameterType="string" resultMap="WorkOrderAcceptResult">
        SELECT concat(DATEDIFF(click_time,accept_time),"天") as processing_time from work_order_accept
        where work_order_no = #{workOrderNo}
    </select>
    <update id="updateHangReason"  parameterType="com.paic.ehis.cs.domain.vo.ComplaintDealVo">
        update work_order_accept
        <trim prefix="SET" suffixOverrides=",">
            <if test="hangFlag != null">hang_flag = #{hangFlag},</if>
            <if test="hangReason != null">hang_reason = #{hangReason},</if>
        </trim>
            where  work_order_no = #{workOrderNo}
    </update>
    <select id="selectHangFlag" parameterType="com.paic.ehis.cs.domain.WorkOrderAccept" resultMap="WorkOrderAcceptResult">
        select work_order_no,hang_flag,hang_reason from work_order_accept
            where work_order_no=#{workOrderNo}
    </select>

    <update id="updateClickTime"  parameterType="com.paic.ehis.cs.domain.WorkOrderAccept">
        update work_order_accept
        set click_time = #{clickTime} , update_by=#{updateBy} , update_time = #{updateTime}
        where  work_order_no = #{workOrderNo} and ifnull(click_time,'')= ''
    </update>

</mapper>